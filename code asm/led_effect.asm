BASE DATA 30H 
MASK DATA 31H
PLUS DATA 32H
J DATA 33H

ORG 0000H
	
MAIN:
	LCALL EFFECT_DICH 
	LCALL EFFECT_SANGDON
    LCALL EFFECT_TATDAN
	LCALL EFFECT_CHOPTAT
	LCALL EFFECT_SANGDAN 
	SJMP MAIN

EFFECT_DICH: 
	MOV A, #0FEH ; 1111 1110 P2.0 sang 
DICH_LOOP:
	MOV P2,A 
	LCALL DELAY200MS 
	RL A
	CJNE A, #7FH, DICH_LOOP ; ss P2.7 = 1 -> quay lai P2.0
	MOV P2, #7FH  
    LCALL DELAY200MS 
	;MOV A, #0FEH
    RET   
	
EFFECT_TATDAN:
	MOV A, #00
TATDAN_LOOP:
	MOV P2, A
	LCALL DELAY200MS
	
	RL A 
	ORL A, #01H ; dua bit 1 
	
	CJNE A, #0FFH, TATDAN_LOOP 
	MOV A, #000H
    RET
	
EFFECT_SANGDAN:
	MOV A, #0FFH
SANGDAN_LOOP:
	MOV P2, A
	RL A 
	ANL A, #0FEH ; 1111 1110 
	LCALL DELAY200MS
	CJNE A, #00H, SANGDAN_LOOP
	MOV A, #0FFH
    RET

EFFECT_CHOPTAT:
	SETB P2.0
	SETB P2.1
	SETB P2.2
    SETB P2.3 ; LED tat
	SETB P2.4
	SETB P2.5
	SETB P2.6
	SETB P2.7
	MOV R0, #5
CHOPTAT_LOOP:
	CPL P2.0
	CPL P2.1
	CPL P2.2	
    CPL P2.3 ; LED dao
	CPL P2.4
	CPL P2.5
	CPL P2.6	
	CPL P2.7
    LCALL DELAY200MS
    DJNZ R0, CHOPTAT_LOOP
	LCALL MAIN
    RET

EFFECT_SANGDON:
    MOV BASE, #0FFH 
    MOV MASK, #0FFH
    MOV R4, #0 ;i                 

FOR_I:
    CJNE R4,#8, OK_I
    RET
    ;SJMP MAIN_LOOP
OK_I:
    MOV A, BASE
    CLR C
    RRC A
    MOV BASE, A
    MOV PLUS, #01H

    MOV A, #9
    CLR C
    SUBB A, R4     ; A = 8 - i
    MOV J , A
FOR_J:
    DJNZ J, OK_J
    SJMP END_J
OK_J:
    MOV A, PLUS 
    CPL A ; A = ~plus
    ANL A, MASK ; A = mask & ~plus
    MOV P2, A

    MOV A, PLUS 
    RL A 
    MOV PLUS, A
    LCALL DELAY200MS
    SJMP FOR_J
END_J: 
    MOV MASK, BASE 
    INC R4
    SJMP FOR_I

DELAY200MS:
    MOV R2, #200
D2:
    MOV R1, #200
D1:
    NOP
    NOP
    NOP
    DJNZ R1, D1
    DJNZ R2, D2
    RET

END
