C51 COMPILER V9.60.0.0   KT                                                                12/25/2025 10:53:36 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KT
OBJECT MODULE PLACED IN .\Objects\kt.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE kt.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\kt.lst
                    -) TABS(2) OBJECT(.\Objects\kt.obj)

line level    source

   1          #include <REGX51.H>
   2          #include <stdio.h>
   3          #define SEGMENT_PORT P0  
   4          #define SELECT_PORT  P2 
   5          
   6          
   7          sbit LED1 = P1^7;
   8          sbit LED2 = P1^6;
   9          sbit LED3 = P1^5;
  10          
  11          sbit BTN1 = P3^2;   
  12          sbit BTN2 = P3^3; 
  13          volatile unsigned int PERIOD  = 0, ms_tick = 0, state = 0;
  14          void UART_Receive_Handler(void);
  15          
  16          volatile unsigned char scan_index = 0;   
  17          
  18          void delay_ms(unsigned int ms)
  19          {
  20   1          unsigned int i, j;
  21   1          for (i = 0; i < ms; i++)
  22   1              for (j = 0; j < 123; j++);
  23   1      }
  24          
  25          
  26          /* Timer 1 Uart */
  27          void UART_Init(void) {
  28   1          SCON = 0x50;        // UART mode 1, enable receiver
  29   1          TMOD &= 0x0F;       // Clear Timer1 config
  30   1          TMOD |= 0x20;       // Timer1 mode 2
  31   1          TH1 = 0xFD;         // Baud 9600 (11.0592 MHz)
  32   1          TR1 = 1;            // Start Timer1
  33   1          TI = 1;             // Allow first transmit
  34   1      }
  35          void UART_SendChar(char c) {
  36   1          while (!TI);   
  37   1          TI = 0;        
  38   1          SBUF = c;      
  39   1      }
  40          
  41          void UART_SendString(char *str) {
  42   1          while (*str) {
  43   2              UART_SendChar(*str);  
  44   2              str++;                
  45   2          }
  46   1      }
  47          
  48          
  49          unsigned char digit_patterns[] = {
  50              0x3F,   // 0
  51              0x06,   // 1
  52              0x5B,   // 2
  53              0x4F,   // 3
  54              0x66,   // 4
C51 COMPILER V9.60.0.0   KT                                                                12/25/2025 10:53:36 PAGE 2   

  55              0x6D,   // 5F
  56              0x7D,   // 6
  57              0x07,   // 7
  58              0x7F,   // 8
  59              0x6F    // 9
  60          };
  61          void Display_Menu(void) {
  62   1          
  63   1          UART_SendString("\r\n=====DIEU KHIEN CHU KY LED=====\r\n");
  64   1      }
  65          
  66          unsigned char uart_index = 0;
  67          char cmd[100];
  68          
  69          void Process_CK(void)
  70          {
  71   1          if (cmd[0] >='0' && cmd[0] <= '7')
  72   1          {
  73   2            //UART_SendChar(cmd[2]);
  74   2            if (cmd[2] == 'n') 
  75   2            {
  76   3              //UART_SendChar(cmd[5]);
  77   3              LED1 = 0; 
  78   3              if(cmd[5] == 'n') LED2 = 0;
  79   3              else LED2 = 1;
  80   3            }
  81   2            else 
  82   2            {
  83   3              //UART_SendChar(cmd[6]);
  84   3              LED1 = 1;
  85   3              if (cmd[6] == 'n') LED2 = 0;
  86   3              else LED2 = 1;
  87   3            }
  88   2            if (LED1 == 0 && LED2 == 0) LED3 = 0;
  89   2            else LED3 = 1;    
  90   2          }
  91   1          if (cmd[0] == 'M' && cmd[1] == '1')
  92   1          {
  93   2            PERIOD =(cmd[3]-'0') * 1000 + (cmd[4]-'0')*100 + (cmd[5]-'0') * 10 + (cmd[6]-'0');
  94   2            if (LED1 == 0) delay_ms(PERIOD);
  95   2            LED1 = 1;
  96   2            if (LED2 == 0) delay_ms(PERIOD);
  97   2            LED2 = 1;
  98   2            if (LED3 == 0) delay_ms(PERIOD);
  99   2            LED3 = 1;
 100   2          }
 101   1          if (cmd[0] == 'M' && cmd[1] == '0')
 102   1          {
 103   2            LED1 = LED2 = LED3 = 1;
 104   2            if (state == 0) 
 105   2            {
 106   3              LED1 = LED2 = LED3 = 1;
 107   3              EX0 = 0;   
 108   3              EX1 = 0;   
 109   3            }
 110   2            else 
 111   2            { 
 112   3              LED1 = LED2 = LED3 = 1;
 113   3              EX0 = 1;   
 114   3              EX1 = 1;   
 115   3            }
 116   2          }
C51 COMPILER V9.60.0.0   KT                                                                12/25/2025 10:53:36 PAGE 3   

 117   1          UART_SendString("\r\nSet OK\r\n");
 118   1      }
 119          
 120          void UART_Receive_Handler(void)
 121          {
 122   1          char c;
 123   1          
 124   1          if (RI)
 125   1          {
 126   2              RI = 0;
 127   2              c = SBUF;
 128   2              
 129   2              if (c == '\r' || c == '\n')
 130   2              {
 131   3                 if (cmd[0] == 'M' && cmd[1] == '0') state = ~state;
 132   3                 Process_CK();  
 133   3                 uart_index = 0; 
 134   3              }
 135   2              else 
 136   2              {
 137   3                cmd[uart_index] = c;   
 138   3                uart_index++;         
 139   3              }
 140   2            }
 141   1      }
 142                  
 143          
 144          
 145          void display_digit(unsigned char index, unsigned char value, unsigned char dot)
 146          {
 147   1          if (dot == 0){
 148   2            SELECT_PORT = (index << 2);
 149   2            SEGMENT_PORT = digit_patterns[value];
 150   2            delay_ms(1);
 151   2          }
 152   1          else 
 153   1          {
 154   2            SELECT_PORT = (index << 2);
 155   2            SEGMENT_PORT = digit_patterns[value] | 0x80;
 156   2            delay_ms(1);
 157   2          }
 158   1            
 159   1      }
 160          
 161          void int0_isr(void) interrupt 0
 162          {
 163   1          LED1 = ~LED1; 
 164   1          if (LED1 == 0 && LED2 == 0) LED3 = 0;
 165   1          else LED3 = 1;
 166   1      }
 167          void int1_isr(void) interrupt 2
 168          { 
 169   1          LED2 = ~LED2; 
 170   1          if (LED1 == 0 && LED2 == 0) LED3 = 0;
 171   1          else LED3 = 1;
 172   1      }
 173          
 174          
 175          void main(void)
 176          {
 177   1          UART_Init();
 178   1          Display_Menu();
C51 COMPILER V9.60.0.0   KT                                                                12/25/2025 10:53:36 PAGE 4   

 179   1          state = 0;
 180   1          LED1 = LED2 = LED3 = 1;
 181   1          IT0 = 1;   
 182   1          IT1 = 1;  
 183   1          EX0 = 1;   
 184   1          EX1 = 1;   
 185   1          EA  = 1;  
 186   1          while (1) {
 187   2            UART_Receive_Handler();
 188   2            if (LED1 == 1 && LED2 == 1 && LED3 == 1)
 189   2            {     
 190   3              display_digit(0, ~LED1, 0); 
 191   3              display_digit(1, ~LED2, 0); 
 192   3              display_digit(2, ~LED3, 0); 
 193   3              display_digit(3, 0, 0); 
 194   3            }
 195   2            else 
 196   2            {
 197   3              display_digit(0, ~LED1, 0); 
 198   3              display_digit(1, ~LED2, 0); 
 199   3              display_digit(2, ~LED3, 0); 
 200   3              display_digit(3, 1, 0); 
 201   3            }
 202   2          }
 203   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    629    ----
   CONSTANT SIZE    =     47    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =    118       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
