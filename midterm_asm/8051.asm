SEGMENT_PORT EQU P0
VALUE        DATA 30H
FLAG_STOP    BIT 20H
T_DELAY      DATA 32H

ORG 0000H
    LJMP MAIN

ORG 0003H
INT0_ISR:
    SETB FLAG_STOP
    RETI

MAIN:
    SETB IT0
    SETB EX0
    SETB EA

    SETB P3.0
    SETB P3.3
	SETB P3.1

    CLR FLAG_STOP
    MOV R0, #00H
    MOV T_DELAY, #100

TATDAN_LOOP:
    JNB P3.0, DEC_T
    JNB P3.3, INC_T
    JB FLAG_STOP, BNT_C

DEC_T:
    MOV A, T_DELAY
    SUBB A, #50
    JC LIMIT_T
    MOV T_DELAY, A
    SJMP SKIP_T

LIMIT_T:
    MOV T_DELAY, #50

INC_T:
    MOV A, T_DELAY
    ADD A, #50
    CJNE A, #200, LIMIT2
    MOV A, #200
LIMIT2:
    MOV T_DELAY, A

SKIP_T:
    MOV P2, R0
    SETB P2.4
    SETB P2.5
    SETB P2.6
    SETB P2.7

    LCALL DELAY_VARIABLE

    MOV A, R0
    RL A
    ORL A, #01H
    MOV R0, A

    CJNE R0, #01FH, TATDAN_LOOP
    MOV R0, #00H
    SJMP TATDAN_LOOP

BNT_C:
    MOV P2, #00H
    SETB P2.4
    SETB P2.5
    SETB P2.6
    SETB P2.7
CHECK_C:
    JNB P3.1, BNT_D
    SJMP CHECK_C

BNT_D:
    CLR FLAG_STOP
    MOV R0, #00H
    SJMP TATDAN_LOOP

DELAY_10MS:
    MOV R5, #20      
D1:
    MOV R6, #250     
D2:
    DJNZ R6, D2 ; 500
    DJNZ R5, D1 
    RET

DELAY_VARIABLE:
    MOV R7, T_DELAY
DVAR:
    LCALL DELAY_10MS
    DJNZ R7, DVAR
    RET

END
